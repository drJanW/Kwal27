todo list
Updated: 2026-01-05

REGEL: Geen "Completed" sectie. Succes = delete uit todo.

=== Active ===
B6. Brightness slider lux trigger met cooldown
    - Slider change triggert lux herberekening met 60s cooldown
    - baseBrightness wordt niet herberekend na slider change
    - Zie: docs/plan_b6_brightness_cooldown.md
    - FIX NEEDED: Replace millis() with boolean+timer pattern
    - FIX NEEDED: pushState() after lux measurement for SSE update

b9. Re-read calendar after midnight for new day

b10. Calibrating lux sensor

b11. Rename luxBeta → luxOffset in Globals.h + Globals.cpp
    - Variable meaning changed from "exponential steepness" to "linear offset"
    - Name should match purpose
    - Also update parser in Globals.cpp

b12. Replace linear lux formula with Stevens' power law
    - Current: linear (luxFactor = offset + scale × lux/L_MAX)
    - Target: power law (luxFactor = floor + (1-floor) × (lux/L_MAX)^gamma)
    - Add luxGamma global (0.33-0.5 range, default 0.4)
    - Matches human brightness perception
    - More output change in low-lux range where eye is most sensitive

=== Future ===
F1. Sensor + Speak architecture completion
    - Verplaats sensor orchestratie van SensorManager naar SensorDirector
    - Koppel sensor events aan SpeakIntent (DISTANCE_TOO_CLOSE, LUX_LOW, etc)
    - Beide modules volledig Boot→Conduct→Policy→Director patroon
    - Zie: docs/plan_f1_sensor_speak.md

F2. HTTP upload endpoint voor SD card
    - Voeg POST /api/sd/upload endpoint toe aan WebInterface
    - Multipart form-data voor file upload
    - Werkt met browser en PowerShell scripts

F3. Simplify brightness shifts: HSV V → FastLED
    - Verwijder colorA.value/colorB.value uit colorsShifts.csv
    - Voeg globalBrightness kolom toe
    - Pas FastLED.setBrightness() aan ipv HSV V-component
    - Behoud H/S shifts via HSV
    - Zie: docs/plan_f3_brightness_shift_simplify.md

F9. Implement distanceAnimationFor() in LightPolicy
    - Currently a stub returning false
    - Distance-driven LED animation modulation
    - Stub location: LightPolicy.cpp:47

=== Minor Bugs ===


=== Housekeeping ===
H1. Refactor codebase according to glossary terminology rules
    - modifier (0-1), multiplier (any float), pct (0-100), shift (additive)
    - brightness (not bright), volume (not gain except I2S)
    - Rename globalBrightness → brightnessHiShift in CSV
    - Zie: docs/glossary_slider_semantics.md

H2. Refactor applyFinalBrightness() in LightManager.cpp
    - Rename to applyBrightness() (glossary: no "final")
    - Audio mixing violates A1: direct AudioState access without Conduct
    - Bad names: raw, n, adj → audioLevel, normalized, audioModifier
    - Redundant: webModifier copied to brightnessModifier for no reason
    - mapRange clamps modifier 0-1, blocks F9 override above hiPct
    - Change to linear: brightness = Lo + (modifier × (Hi - Lo))
    - Clamp result to unshiftedHi, not shiftedHi
    - isWebInterfaceActive() check overbodig: reset webThumbPct=-1 bij disconnect
    - shiftedLo berekening irrelevant voor F9: thumbPct moet direct naar brightness
    - F9 fix: brightness = (thumbPct/100) × Globals::maxBrightness, clamp to unshiftedHi
    - NOTE: mapping logic is fine, Copilot keeps breaking it with bad names/logic

H3. Make webShift and brightnessShiftedHi atomic
    - LightManager.cpp: webShift en brightnessShiftedHi zijn niet atomic
    - AudioState.cpp gebruikt WEL std::atomic voor g_volumeShiftedHi, g_volumeWebModifier
    - Voor consistentie en thread-safety: maak ze atomic

H4. Refactor WiFiManager.cpp timer usage
    - Does not use timers correctly, superfluous state checking
    - Source: A56/WiFiManager.cpp

H5. Refactor BootMaster.cpp
    - Clean up, check overlap with SystemBoot.cpp
    - Source: A56/BootMaster.cpp

H6. Review SDVoting.cpp file selection
    - Contains random file selection logic - belongs in Director?
    - Source: A56/SDVoting.cpp

H7. Review StatusPolicy.cpp stub
    - Determine if refactor needed or intentionally minimal
    - Source: A56/StatusPolicy.cpp

H8. Review TimerManager::instance() pattern
    - Consider global `timers` reference vs singleton
    - See A56/TodoSal.txt for DI architecture notes
    - Pattern: std::atomic<float> webShift{1.0f}; met .load()/.store()


### not ordered new issues/ideas

